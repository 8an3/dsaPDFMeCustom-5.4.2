<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Webpack App</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap"
      rel="stylesheet"
    />
  </head>
  <body style="margin: 0">
    <div>
      <a href="./">Back</a>
      /
      <button onclick="init()">init</button>
      /
      <button onclick="destroy()">destroy</button>
      /
      <button onclick="saveTemplate()">saveTemplate</button>
      /
      <button onclick="updateTemplate()">updateTemplate</button>
      /
      <button onclick="generate()">generate</button>
      /
      <label>
        loadTemplate
        <input type="file" accept="application/json" onchange="loadTemplate(this.files[0])" />
      </label>
    </div>
    <div id="app"></div>
    <script src="./index.js"></script>
    <script>
      let editor = null;

      function init() {
        editor = new LabelmakeUi.TemplateDesigner({
          domContainer,
          template: getTemplate(),
          saveTemplate: (t) => {
            console.log({ ...t, basePdf: 'skip...' });
            const tj = JSON.stringify(t, null, 2);
            localStorage.setItem('template', tj);
          },
          size,
          options: {
            font: { label: 'Noto Sans JP', value: 'Noto Sans JP' },
          },
        });
      }

      function destroy() {
        editor.destroy();
      }

      function saveTemplate() {
        editor.saveTemplate();
      }

      function updateTemplate() {
        editor.updateTemplate(getSampleTemplate());
      }

      function loadTemplate(file) {
        const reader = new FileReader();
        reader.onload = () => {
          editor.updateTemplate(JSON.parse(reader.result));
        };
        reader.readAsText(file);
      }

      async function generate() {
        const font = await getFont();
        const template = getTemplate();
        const inputs = template.sampledata;
        LabelmakeUi.generate({ inputs, template, options: { font } }).then((pdf) => {
          const blob = new Blob([pdf.buffer], { type: 'application/pdf' });
          window.open(URL.createObjectURL(blob));
        });
      }

      window.onload = init;
    </script>
  </body>
</html>
